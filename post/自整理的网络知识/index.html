<!DOCTYPE HTML>

<!-- 
Strata by HTML5 UP
html5up.net | @n33co
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>自整理的网络知识 &middot; Welcome</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="author" content="Bao">
		<meta name="description" content="something meaningful">
		<meta http-equiv="content-language" content="en-us" />

		
		<meta name="og:site_name" content="Welcome">
		<meta name="og:title" content="自整理的网络知识">
		<meta name="og:url" content="https://misstai.github.io/post/%E8%87%AA%E6%95%B4%E7%90%86%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/">
		
		<meta name="og:image" content="https://misstai.github.io/images/avatar.jpg">
		
		

		<meta name="generator" content="Hugo 0.81.0" />

		<!--[if lte IE 8]><script src='https://misstai.github.io/js/ie/html5shiv.js'></script><![endif]-->
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://misstai.github.io/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="https://misstai.github.io//css/ie8.css"><![endif]-->

		
		
	</head>

	<body id="top">
		<!-- Header -->
<header id="header">
	
	<a href="https://misstai.github.io/" class="image avatar"><img src="https://misstai.github.io/images/avatar.jpg" alt="" /></a>
	
	
		<h1><strong>I&rsquo;m Bao</strong>, a super simple<!-- raw HTML omitted --> responsive site . Just to record my work<!-- raw HTML omitted --> and life or something meaningful.</h1>
	

	
		<nav id="sidebar">
			<ul>
			
				<li><a href="https://misstai.github.io/">Home</a></li>
			
				<li><a href="https://misstai.github.io/post/">Blog</a></li>
			
			</ul>
		</nav>
	
</header>


		<!-- Main -->
		<div id="main">
			
	<span>
		<h1>自整理的网络知识</h1>

		<i class="fa fa-calendar"></i>&nbsp;&nbsp;
<time datetime="2020-02-08 22:17:46 &#43;0800 CST">2020-02-08</time>&nbsp;&nbsp;







	</span>

	<p>
	    <h2 id="osi七层协议模型">OSI七层协议模型</h2>
<ul>
<li>
<h4 id="应用层">应用层</h4>
<h5 id="ftphttpsmtptelnetdns">FTP、HTTP、SMTP、Telnet、DNS</h5>
</li>
<li>
<h4 id="表示层">表示层</h4>
</li>
<li>
<h4 id="会话层">会话层</h4>
</li>
<li>
<h4 id="传输层">传输层</h4>
<h5 id="tcpudp等">TCP、UDP等</h5>
</li>
<li>
<h4 id="网络层">网络层</h4>
<h5 id="ipicmparp等">IP、ICMP、ARP等</h5>
</li>
<li>
<h4 id="数据链路层">数据链路层</h4>
<h5 id="ppp协议">PPP协议</h5>
</li>
<li>
<h4 id="物理层">物理层</h4>
</li>
</ul>
<p>​                                                                                                                                    ==TCP VS UDP 对比==</p>
<p>都是传输层协议，TCP:传输控制协议    UDP:用户数据包协议</p>
<table>
<thead>
<tr>
<th style="text-align:center">TCP</th>
<th style="text-align:center">UDP</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">面向连接</td>
<td style="text-align:center">非面向连接</td>
</tr>
<tr>
<td style="text-align:center">可靠但性能差</td>
<td style="text-align:center">不可靠但性能好</td>
</tr>
<tr>
<td style="text-align:center">带数据包序列</td>
<td style="text-align:center">不带数据包序列</td>
</tr>
<tr>
<td style="text-align:center">全双工直连</td>
<td style="text-align:center">一对一，一对多，多对一，多对多</td>
</tr>
<tr>
<td style="text-align:center">慢开始、拥塞避免，快重传、快恢复</td>
<td style="text-align:center">无拥塞控制</td>
</tr>
<tr>
<td style="text-align:center">对效率要求低，对准确性要求高的场景适用，如下载、Email等</td>
<td style="text-align:center">对效率要求高，准确性要求低的场景适用，如音视频</td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<h2 id="交换基础">交换基础</h2>
<h4 id="交换机接口模式">交换机接口模式</h4>
<p>交换机有三种接口模式</p>
<p>Access、Trunk和Hybrid（混合的）</p>
<h5 id="trunk的作用">Trunk的作用</h5>
<ul>
<li>将交换机与交换机之间连接的端口设置为trunk,实现交换机之间的不同Vlan的通信</li>
<li>使用一条链路，使用标识来区分不同Vlan数据</li>
</ul>
<h5 id="trunk封装类型">Trunk封装类型</h5>
<p>IEEE(华为)    dot1q</p>
<h5 id="trunk配置">Trunk配置</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">[<span style="color:#a6e22e">SwitchA</span>] <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ethernet</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span>            <span style="color:#75715e">//进入端口0/0/24
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span>] <span style="color:#a6e22e">port</span> <span style="color:#a6e22e">link</span><span style="color:#f92672">-</span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">trunk</span> <span style="color:#75715e">//设置端口模式为access
</span><span style="color:#75715e"></span>

[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span>] <span style="color:#a6e22e">port</span> <span style="color:#a6e22e">trunk</span> <span style="color:#a6e22e">allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">pass</span> <span style="color:#a6e22e">vlan</span> <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">20</span>  <span style="color:#75715e">//设置vlan 10 20可以通过trunk
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span>] <span style="color:#a6e22e">quit</span> <span style="color:#75715e">//退出
</span></code></pre></div><h4 id="stp原理">STP原理</h4>
<p><em>STP</em>（Spanning Tree Protocol）是生成树协议的英文缩写，通过在交换网络中部署生成树（Spanning-tree）技术，能够防止网络中出现二层环路。</p>
<p>STP运行后，如果网络中存在环路，那么STP通过阻塞（Block）特定的接口从而打破环路，并且在网络出现拓扑变更时及时收敛，以保证网络的冗余性。</p>
<h5 id="stp的操作">STP的操作</h5>
<p><!-- raw HTML omitted --></p>
<h5 id="mstp">MSTP</h5>
<p>•MSTP兼容STP和RSTP，通过多实例能实现对业务流量和用户流量的隔离，同时还提供了数据转发的多个冗余路径，在数据转发过程中实现VLAN数据的负载均衡。</p>
<p>•在MSTP中，你可以将若干个VLAN映射到一个实例（instance），MSTP将为每个instance运行一棵生成树，可以基于instance设置优先级、端口路径开销等参数。</p>
<p><!-- raw HTML omitted --></p>
<h4 id="vlan基础">VLAN基础</h4>
<h5 id="vlan的概念">Vlan的概念</h5>
<p>vlan（Virtual Local Area Network）的中文名为&quot;虚拟局域网&quot;,作用是分割广播域，控制广播风暴、增强网络的安全性、简化网络管理。</p>
<h5 id="vlan的划分">Vlan的划分</h5>
<ul>
<li>交换机单接口加入vlan</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">[<span style="color:#a6e22e">Quidway</span>] <span style="color:#a6e22e">system</span><span style="color:#f92672">-</span><span style="color:#a6e22e">view</span> <span style="color:#75715e">//进入配置视图
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">Quidway</span>] <span style="color:#a6e22e">sysname</span> <span style="color:#a6e22e">SwitchA</span> <span style="color:#75715e">//给交换机命名
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span>] <span style="color:#a6e22e">vlan</span> <span style="color:#a6e22e">batch</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#75715e">//同时创建vlan2与vlan3
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span>] <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ethernet</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span> <span style="color:#75715e">//进入端口0/0/1
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>] <span style="color:#a6e22e">port</span> <span style="color:#a6e22e">link</span><span style="color:#f92672">-</span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">access</span> <span style="color:#75715e">//设置端口模式为access
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>] <span style="color:#a6e22e">port</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">vlan</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e">//将端口加入vlan2中
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>] <span style="color:#a6e22e">quit</span> <span style="color:#75715e">//退出
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span>] <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ethernet</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#75715e">//进入端口0/0/2
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>] <span style="color:#a6e22e">port</span> <span style="color:#a6e22e">link</span><span style="color:#f92672">-</span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">access</span> <span style="color:#75715e">//端口模式为access
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>] <span style="color:#a6e22e">port</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">vlan</span> <span style="color:#ae81ff">3</span> <span style="color:#75715e">//将端口加入vlan3中
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>] <span style="color:#a6e22e">quit</span> <span style="color:#75715e">//退出
</span></code></pre></div><ul>
<li>交换机接口批量加入vlan</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">[<span style="color:#a6e22e">HW2700</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>] <span style="color:#a6e22e">vlan</span> <span style="color:#a6e22e">batch</span> <span style="color:#ae81ff">2</span> <span style="color:#a6e22e">to</span> <span style="color:#ae81ff">5</span>

[<span style="color:#a6e22e">HW2700</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]<span style="color:#a6e22e">port</span><span style="color:#f92672">-</span><span style="color:#a6e22e">group</span> <span style="color:#a6e22e">g2</span>

[<span style="color:#a6e22e">HW2700</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">port</span><span style="color:#f92672">-</span><span style="color:#a6e22e">group</span><span style="color:#f92672">-</span><span style="color:#a6e22e">g2</span>]<span style="color:#a6e22e">group</span><span style="color:#f92672">-</span><span style="color:#a6e22e">member</span> <span style="color:#a6e22e">Ethernet</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">Ethernet</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span>       <span style="color:#75715e">//选择1~6 端口加入group
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">HW2700</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">port</span><span style="color:#f92672">-</span><span style="color:#a6e22e">group</span><span style="color:#f92672">-</span><span style="color:#a6e22e">g2</span>]<span style="color:#a6e22e">port</span> <span style="color:#a6e22e">link</span><span style="color:#f92672">-</span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">access</span>      <span style="color:#75715e">//接口为access口，显示1~6口设置为access类型
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">HW2700</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">port</span><span style="color:#f92672">-</span><span style="color:#a6e22e">group</span><span style="color:#f92672">-</span><span style="color:#a6e22e">g2</span>]<span style="color:#a6e22e">port</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">vlan</span> <span style="color:#ae81ff">2</span>        <span style="color:#75715e">//端口组所有端口加入vlan2
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">HW2700</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]<span style="color:#a6e22e">dis</span> <span style="color:#a6e22e">vlan</span>   <span style="color:#75715e">//显示vlan信息
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">HW2700</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]<span style="color:#a6e22e">port</span><span style="color:#f92672">-</span><span style="color:#a6e22e">group</span> <span style="color:#a6e22e">g3</span>

[<span style="color:#a6e22e">HW2700</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">port</span><span style="color:#f92672">-</span><span style="color:#a6e22e">group</span><span style="color:#f92672">-</span><span style="color:#a6e22e">g3</span>]<span style="color:#a6e22e">group</span><span style="color:#f92672">-</span><span style="color:#a6e22e">member</span> <span style="color:#a6e22e">Ethernet</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">Ethernet</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span>

[<span style="color:#a6e22e">HW2700</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">port</span><span style="color:#f92672">-</span><span style="color:#a6e22e">group</span><span style="color:#f92672">-</span><span style="color:#a6e22e">g3</span>]<span style="color:#a6e22e">port</span> <span style="color:#a6e22e">link</span><span style="color:#f92672">-</span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">access</span>     <span style="color:#75715e">//所有接口配置为access类型
</span><span style="color:#75715e"></span>[<span style="color:#a6e22e">HW2700</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">port</span><span style="color:#f92672">-</span><span style="color:#a6e22e">group</span><span style="color:#f92672">-</span><span style="color:#a6e22e">g3</span>]<span style="color:#a6e22e">port</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">vlan</span> <span style="color:#ae81ff">3</span>      <span style="color:#75715e">//端口组所有端口加入vlan3
</span></code></pre></div><h5 id="vlan间路由互通">VLAN间路由互通</h5>
<h6 id="通过子接口实现vlan间路由互通">通过子接口实现vlan间路由互通</h6>
<p>在路由器以太网接口上进行“子接口”的划分，与交换机的Trunk链路对接</p>
<h6 id="子接口也叫单臂路由sub-interface特点">子接口也叫单臂路由（sub-interface）特点</h6>
<ol>
<li>软件的，逻辑接口</li>
<li>可以配置IP,指定vlan-id</li>
<li>GE 0/0/0.10   GE 0/0/0.20  &hellip; 接口名称可自定义</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">GE</span> <span style="color:#a6e22e">o</span><span style="color:#f92672">/</span><span style="color:#a6e22e">o</span><span style="color:#f92672">/</span><span style="color:#a6e22e">o</span><span style="color:#ae81ff">.10</span> <span style="color:#a6e22e">配置地址192</span><span style="color:#ae81ff">.169.10.254</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span>     <span style="color:#75715e">//为vlan10的网关地址，相呼应
</span><span style="color:#75715e"></span><span style="color:#a6e22e">GE</span> <span style="color:#a6e22e">o</span><span style="color:#f92672">/</span><span style="color:#a6e22e">o</span><span style="color:#f92672">/</span><span style="color:#a6e22e">o</span><span style="color:#ae81ff">.20</span> <span style="color:#a6e22e">配置地址192</span><span style="color:#ae81ff">.169.20.254</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span>     <span style="color:#75715e">//为vlan20的网关地址，相呼应
</span></code></pre></div><p><!-- raw HTML omitted --></p>
<h6 id="vlanif">Vlanif</h6>
<p>Vlanif（Vlan interface)工作原理（一般在三层交换机上配置）</p>
<p>三层交换机进行三层转发的关键就是在每个VLAN基础上虚拟出一个vlanif接口，并配上IP，从而实现三层转发</p>
<p><!-- raw HTML omitted --></p>
<p>Vlan interface基础配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">[<span style="color:#a6e22e">SwitchA</span>] <span style="color:#a6e22e">vlan</span> <span style="color:#a6e22e">batch</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#75715e">//同时创建vlan2与vlan3
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span>] <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ethernet</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span> <span style="color:#75715e">//进入端口0/0/1
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>] <span style="color:#a6e22e">port</span> <span style="color:#a6e22e">link</span><span style="color:#f92672">-</span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">access</span> <span style="color:#75715e">//设置端口模式为access
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>] <span style="color:#a6e22e">port</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">vlan</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e">//将端口加入vlan2中
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>] <span style="color:#a6e22e">quit</span> <span style="color:#75715e">//退出
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span>] <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ethernet</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#75715e">//进入端口0/0/2
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>] <span style="color:#a6e22e">port</span> <span style="color:#a6e22e">link</span><span style="color:#f92672">-</span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">access</span> <span style="color:#75715e">//端口模式为access
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>] <span style="color:#a6e22e">port</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">vlan</span> <span style="color:#ae81ff">3</span> <span style="color:#75715e">//将端口加入vlan3中
</span><span style="color:#75715e"></span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Ethernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>] <span style="color:#a6e22e">quit</span> <span style="color:#75715e">//退出
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">为vlanif10及vlanif20配置IP地址</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">作为vlan10和vlan20用户的网关</span>
[<span style="color:#a6e22e">SwitchA</span>] <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">vlanif</span> <span style="color:#ae81ff">10</span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">vlanif10</span>] <span style="color:#a6e22e">ip</span> <span style="color:#a6e22e">addr</span> <span style="color:#ae81ff">192.168.10.254</span> <span style="color:#ae81ff">24</span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">vlanif10</span>] <span style="color:#a6e22e">quit</span>      <span style="color:#75715e">//退出
</span><span style="color:#75715e"></span>[<span style="color:#a6e22e">SwitchA</span>] <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">vlanif</span> <span style="color:#ae81ff">20</span>
[<span style="color:#a6e22e">SwitchA</span><span style="color:#f92672">-</span><span style="color:#a6e22e">vlanif20</span>] <span style="color:#a6e22e">ip</span> <span style="color:#a6e22e">addr</span> <span style="color:#ae81ff">192.168.20.254</span> <span style="color:#ae81ff">24</span>
</code></pre></div><p>二、三层交换机、路由器简单组网</p>
<p><!-- raw HTML omitted --></p>
<h4 id="交换机端口镜像与链路聚合">交换机端口镜像与链路聚合</h4>
<h5 id="端口镜像">端口镜像</h5>
<p>在某些场景中，我们需要监控交换机特定端口的入站或出站报文。</p>
<h5 id="链路聚合">链路聚合</h5>
<p>•链路聚合（Link Aggregation）是将—组物理接口捆绑在一起作为一个逻辑接口来增加带宽的一种方法，又称为多接口负载均衡组（Load Sharing Group）或链路聚合组（Link Aggregation Group），相关的协议标准请参考IEEE802.3ad。</p>
<p>•通过在两台设备之间建立链路聚合组，可以提供更高的通讯带宽和更高的可靠性。链路聚合不仅为设备间通信提供了冗余保护，而且不需要对硬件进行升级。</p>
<p><!-- raw HTML omitted --></p>
<h5 id="eth-trunk的工作模式">Eth-trunk的工作模式</h5>
<p>华为的网络设备支持两种Eth-trunk工作模式：</p>
<ul>
<li>手工负载分担模式</li>
<li>LACP模式</li>
</ul>
<h2 id="路由基础">路由基础</h2>
<h4 id="ip路由选择原理">IP路由选择原理</h4>
<h5 id="路由器的工作内容">路由器的工作内容</h5>
<ul>
<li>发现到达网络中各个网段的路径；</li>
<li>选择最佳路径；</li>
<li>维护路由表及路由信息；</li>
<li>转发数据报文</li>
</ul>
<h5 id="ip路由表">IP路由表</h5>
<p>查看路由表：display ip routing-table</p>
<p>路由条目的来源</p>
<ul>
<li>直连路由 – 直连接口所在网段的路由。</li>
<li>静态路由 – 由网络管理员手工配置的路由条目。</li>
<li>动态路由 – 路由器通过动态路由协议学习到的路由。</li>
</ul>
<h5 id="静态路由配置">静态路由配置</h5>
<p><!-- raw HTML omitted --></p>
<h6 id="静态路由的配置">静态路由的配置</h6>
<ul>
<li>静态路由的配置（关联下一跳IP的方式）：</li>
</ul>
<p>[Router**] ip route-static** 网络号 掩码 下一跳IP地址</p>
<ul>
<li>静态路由的配置（关联出接口的方式）：</li>
</ul>
<p>[Router] <strong>ip route-static</strong> 网络号 掩码 出接口</p>
<ul>
<li>静态路由的配置（关联出接口和下一跳IP的方式）：</li>
</ul>
<p>[Router**] ip route-static** 网络号 掩码 出接口 下一跳IP地址</p>
<p>即                ==目标网段+对应的掩码+下一跳地址==</p>
<p>示例：<strong>[R1] ip route-static</strong> <em>192.168.100.0 24 192.168.12.2</em></p>
<p><!-- raw HTML omitted --></p>
<p><strong>注意：</strong></p>
<ul>
<li>通信是双向的，因此要留意往返流量（的路由）。</li>
<li>路由的行为是逐跳的，因此需保证沿途的每一台路由器都有路由。</li>
</ul>
<h5 id="默认路由">默认路由</h5>
<p>默认路由也被称为缺省路由，一般配置在末梢路由及出口路由上</p>
<p><!-- raw HTML omitted --></p>
<h5 id="路由汇总">路由汇总</h5>
<p><!-- raw HTML omitted --></p>
<h5 id="ip路由查找的最长匹配原则">IP路由查找的最长匹配原则</h5>
<p>当路由器在将目的IP地址在路由表中执行查找时，采用的原则是“最长匹配原则”，也就是查找目的IP地址与路由前缀匹配度最长的表项，使用该表项作为最终数据转发的依据。</p>
<h5 id="路由优先级">路由优先级</h5>
<p><!-- raw HTML omitted --></p>
<p>在配置静态路由时，可以手工指定该静态路由的优先级（在华为网络产品中，静态路由优先级缺省为60）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">ip</span> <span style="color:#a6e22e">route</span><span style="color:#f92672">-</span><span style="color:#a6e22e">static</span> <span style="color:#ae81ff">10.9.9.0</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">10.1.13.1</span>
<span style="color:#a6e22e">ip</span> <span style="color:#a6e22e">route</span><span style="color:#f92672">-</span><span style="color:#a6e22e">static</span> <span style="color:#ae81ff">10.9.9.0</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">10.1.23.2</span> <span style="color:#a6e22e">preference</span> <span style="color:#ae81ff">80</span>
</code></pre></div><p>当某一方链路出现故障另外的路由就出现，以起到冗余的功能</p>
<h5 id="静态路由与bfd">静态路由与BFD</h5>
<h4 id="动态路由协议">动态路由协议</h4>
<h5 id="动态路由协议的分类">动态路由协议的分类</h5>
<p><!-- raw HTML omitted --></p>
<h5 id="距离矢量路由协议rip">距离矢量路由协议（RIP)</h5>
<p>基于UDP520端口，优先级为100，低于静态路由（60）</p>
<h5 id="链路状态路由协议">链路状态路由协议</h5>
<h6 id="工作原理">工作原理</h6>
<ol>
<li>
<p>LSA的泛洪</p>
<p>运行链路状态路由协议的路由器，彼此之间交互的就不是路由信息了，而是LSA（链路状态通告）</p>
</li>
<li>
<p>LSDB的维护</p>
<p>每台路由器将搜集到的LSAs放入自己的LSDB（链路状态数据库）存储起来。有了LSDB，路由器相当于掌握了全网的拓扑。</p>
</li>
<li>
<p>SPF计算</p>
<p>每台路由器基于LSDB，使用SPF（最短路径算法）进行计算，得到一个以自己为根、覆盖全网的一棵无环的树。</p>
</li>
<li>
<p>维护路由表</p>
<p>每台路由器根据SPF的计算结果，将路由加载进路由表。</p>
</li>
</ol>
<h6 id="ospf">OSPF</h6>
<p>​       OSPF(Open Shortest Path First,开放的最短路径优先协议),封装在Ip层，协议号89作为标识。</p>
<p>RouterID</p>
<ul>
<li>OSPF Router-ID用于在OSPF domain中唯一地表示一台OSPF路由器。</li>
<li>OSPF Router-ID的设定可以通过手工配置的方式，或者通过协议自动选取的方式。当然，在实际网络部署中，强烈建议手工配置OSPF的Router-ID，因为这关系到协议的稳定。</li>
</ul>
<p>OSPF Cost</p>
<ul>
<li>OSPF使用cost“开销”作为路由度量值。</li>
<li>OSPF接口cost=100M /接口带宽，其中100M为OSPF的参考带宽（reference-bandwidth），可以修改。</li>
<li>每一个激活OSPF的接口都有一个cost值。</li>
<li>一条OSPF路由的cost由该路由从起源一路到达本地的所有入接口cost值的总和。</li>
</ul>
<p><!-- raw HTML omitted --></p>
<p>​                                                         <strong>实际组网中经常通过修改cost以达到路由优选以及链路冗余</strong></p>
<p>OSPF的三张表</p>
<ul>
<li>
<p>邻居表（Peer table）：</p>
<p>OSPF是一种可靠的路由协议，要求在路由器之间传递链路状态通告之前，需先建立OSPF邻居关系，hello报文用于发现直连链路上的其他OSPF路由器，再经过一系列的OSPF消息交互最终建立起全毗邻的邻居关系，OSPF路由器的邻居信息显示在邻居表中。</p>
</li>
<li>
<p>链路状态数据库（Link-state database，简称LSDB）：</p>
<p>OSPF用LSA（link state Advertisement，链路状态通告）来描述网络拓扑信息，然后OSPF路由器用LSDB来存储网络的这些LSA。OSPF将自己产生的以及邻居通告的LSA搜集并存储在LSDB中。掌握LSDB的查看以及对LSA的深入分析才能够深入理解OSPF。</p>
</li>
<li>
<p>OSPF路由表（Routing  table）：</p>
<p>基于LSDB进行SPF（Dijkstra算法）计算，而得出的OSPF路由表。</p>
</li>
</ul>
<p>OSPF五种报文</p>
<ol>
<li>Hello报文    建立和维护OSPF邻居关系</li>
<li>DBD报文    链路状态数据库描述信息（描述LSDB中LSA头部信息），用于两台设备进行数据库同步</li>
<li>LSR报文    链路状态请求，用于向对方请求所需的LSA</li>
<li>LSU报文    链路状态更新，用于向对方发送其所需的LSA(一条或者多条LSA)</li>
<li>LSAck报文    用来对收到的LSU中的LSA进行确认</li>
</ol>
<p>DR、BDR</p>
<ul>
<li>为减小多路访问网络中的 OSPF 流量，OSPF 会在每一个MA网络（多路访问网络）选举一个指定路由器 (DR) 和一个备用指定路由器 (BDR)</li>
</ul>
<p>OSPF area</p>
<ul>
<li>减少了LSA洪泛的范围，有效地把拓扑变化控制在区域内，达到网络优化的目的。</li>
<li>在区域边界可以做路由汇总，减小了路由表。</li>
<li>充分利用OSPF特殊区域的特性，进一步减少LSA泛洪，从而优化路由。</li>
<li>多区域提高了网络的扩展性，有利于组建大规模的网络</li>
</ul>
<p><!-- raw HTML omitted --></p>
<h6 id="单区域ospf的基础配置">单区域OSPF的基础配置</h6>
<p><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">R1的配置如下</span><span style="color:#960050;background-color:#1e0010">：</span>
    [<span style="color:#a6e22e">R1</span>] <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">GE0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span>
    [<span style="color:#a6e22e">R1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">GigabitEthernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span>] <span style="color:#a6e22e">ip</span> <span style="color:#a6e22e">add</span> <span style="color:#ae81ff">192.168.12.1</span> <span style="color:#ae81ff">24</span>
    [<span style="color:#a6e22e">R1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">GigabitEthernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">g</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>
    [<span style="color:#a6e22e">R1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">GigabitEthernet0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>] <span style="color:#a6e22e">ip</span> <span style="color:#a6e22e">add</span> <span style="color:#ae81ff">192.168.1.254</span> <span style="color:#ae81ff">24</span>

	[<span style="color:#a6e22e">R1</span>] <span style="color:#a6e22e">ospf</span> <span style="color:#ae81ff">1</span> <span style="color:#a6e22e">router</span><span style="color:#f92672">-</span><span style="color:#a6e22e">id</span> <span style="color:#ae81ff">1.1.1.1</span>
	[<span style="color:#a6e22e">R1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ospf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#a6e22e">area</span> <span style="color:#ae81ff">0</span>
	[<span style="color:#a6e22e">R1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ospf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">area</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.0.0.0</span>] <span style="color:#a6e22e">network</span> <span style="color:#ae81ff">192.168.12.0</span> <span style="color:#ae81ff">0.0.0.255</span>
	[<span style="color:#a6e22e">R1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ospf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">area</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.0.0.0</span>] <span style="color:#a6e22e">network</span> <span style="color:#ae81ff">192.168.1.0</span> <span style="color:#ae81ff">0.0.0.255</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">R2的配置如下</span><span style="color:#960050;background-color:#1e0010">：</span>
	[<span style="color:#a6e22e">R2</span>] <span style="color:#a6e22e">ospf</span> <span style="color:#ae81ff">1</span> <span style="color:#a6e22e">router</span><span style="color:#f92672">-</span><span style="color:#a6e22e">id</span> <span style="color:#ae81ff">2.2.2.2</span>
	[<span style="color:#a6e22e">R2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ospf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#a6e22e">area</span> <span style="color:#ae81ff">0</span>
	[<span style="color:#a6e22e">R2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ospf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">area</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.0.0.0</span>] <span style="color:#a6e22e">network</span> <span style="color:#ae81ff">192.168.12.0</span> <span style="color:#ae81ff">0.0.0.255</span>
	[<span style="color:#a6e22e">R2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ospf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">area</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.0.0.0</span>] <span style="color:#a6e22e">network</span> <span style="color:#ae81ff">192.168.23.0</span> <span style="color:#ae81ff">0.0.0.255</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">R3的配置如下</span><span style="color:#960050;background-color:#1e0010">：</span>
	[<span style="color:#a6e22e">R3</span>] <span style="color:#a6e22e">ospf</span> <span style="color:#ae81ff">1</span> <span style="color:#a6e22e">router</span><span style="color:#f92672">-</span><span style="color:#a6e22e">id</span> <span style="color:#ae81ff">3.3.3.3</span>
	[<span style="color:#a6e22e">R3</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ospf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#a6e22e">area</span> <span style="color:#ae81ff">0</span>
	[<span style="color:#a6e22e">R3</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ospf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">area</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.0.0.0</span>] <span style="color:#a6e22e">network</span> <span style="color:#ae81ff">192.168.2.0</span> <span style="color:#ae81ff">0.0.0.255</span>
	[<span style="color:#a6e22e">R3</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ospf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">area</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.0.0.0</span>] <span style="color:#a6e22e">network</span> <span style="color:#ae81ff">192.168.23.0</span> <span style="color:#ae81ff">0.0.0.255</span>
</code></pre></div><h2 id="交换进阶">交换进阶</h2>
<h4 id="smart-link">Smart Link</h4>

	</p>

	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "spf13" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

		</div>

		<!-- Footer -->
<footer id="footer">
	<ul class="icons">
		
		
		
		<li><a href="//twitter.com/spf13" target="_blank" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
		
		
		<li><a href="//github.com/spf13" target="_blank" class="icon fa-github"><span class="label">GitHub</span></a></li>
		
		
		<li><a href="//gitlab.com/spf13" target="_blank" class="icon fa-gitlab"><span class="label">GitLab</span></a></li>
		
		
		
		
		
		<li><a href="https://misstai.github.io/#contact-form" class="icon fa-envelope-o"><span class="label">Email</span></a></li>
		
		
		<li><a href="https://misstai.github.io/index.xml" class="icon fa-rss" type="application/rss+xml"><span class="label">RSS</span></a></li>
		
	</ul>

	<ul class="copyright">
		
		<li>© John Bao</li>
		
		<li>Design: <a href="//html5up.net">HTML5 UP</a></li>
		
		<li>Demo Images: <a href="//unsplash.com/">Unsplash</a></li>
		
	</ul>
</footer>

<!-- Scripts -->
<script src="https://misstai.github.io/js/jquery.min.js"></script>
<script src="https://misstai.github.io/js/jquery.poptrox.min.js"></script>
<script src="https://misstai.github.io/js/skel.min.js"></script>
<script src="https://misstai.github.io/js/util.js"></script>

<script src="https://misstai.github.io/js/main.js"></script>





	</body>
</html>
